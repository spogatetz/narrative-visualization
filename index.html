<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style>
    circle {
        fill: lightblue;
        stroke: black;
    }
</style>

<body onload='init()'>
    <svg width=1200 height=1000>
    </svg>
    <script>
        async function init() {
            var data = await d3.csv("honeyproduction.csv")
            var temp = data.reduce((acc, obj) => {
                const { year, totalprod } = obj;
                if(!acc[year]) {
                    acc[year] = 0;
                }
                acc[year] += parseInt(totalprod);
                return acc;
            }, {})

            console.log(temp)

            var aggregatedData = Object.keys(temp).map((year) => {
                return { year, totalprod: temp[year]}
            })

            console.log(aggregatedData);
            var x = d3.scaleLinear([1998, 2012], [0, 1000]);
            var y = d3.scaleLinear([220000000, 100000000], [0, 800]);

            var svg = d3.select("svg");

            svg.append("g")
                .attr("transform", "translate(100,50)")
                .selectAll("circle").data(aggregatedData).enter().append("circle")
                .attr("cx", (d, i) => x(d.year))
                .attr("cy", (d, i) => y(d.totalprod)) // need to handle summing states
                .attr("r", 5)

            var line = d3.line()
                        .x(d => x(d.year))
                        .y(d => y(d.totalprod));
            svg.append("path")
               .datum(aggregatedData)
               .attr("fill", "none")
               .attr("stroke", "steelblue")
               .attr("stroke-width", 2)
               .attr("d", line)
               .attr("transform", "translate(100,50)")

            svg.append("g")
                .attr("transform", "translate(100,50)")
                .call(d3.axisLeft(y))

            svg.append("g")
                .attr("transform", "translate(100,850)")
                .call(d3.axisBottom(x).tickFormat(d3.format("~")))
        }
    </script>
</body>

</html>